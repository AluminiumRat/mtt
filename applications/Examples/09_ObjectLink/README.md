# Кратко
Используем сцену(класс mtt::Scene) и добавляем связи между независимыми объектами.

# Детально
Представим себе такой случай: у нас есть 2 человека, Боб и Билл. Всё что умеет делать Боб - это забивать болт. Всё что умеет Билл - это просить Боба забить болт. Но ситуация осложняется тем, что периодически нам нужно забирать боба для каких-то своих нужд, и в это время Билл не должен его беспокоить. Другими словами, нам нужно сделать для Билла такую ссылку на Боба, которая может следить за тем, присутствует Боб или нет.

## mtt::Scene
Прежде всего надо определиться, откуда мы будем забирать Боба, и куда мы будем его возвращать. Понятно, что нам нужно какой-то реестр объектов, в котором мы сможем отслеживать совместно работающие объекты. В mtt таким реестром служит класс mtt::Scene:

    mtt::Scene scene;
    scene.registerObject(bill);
    scene.registerObject(bob);
    ...
    scene.unregisterObject(bob);
    ...
    scene.registerObject(bob);

Сцена оповещает свои объекты обо всех регистрациях/дерегистрациях. Также она имеет сигналы Scene::objectRegistered и Scene::objectRegistered, позволяющие подключать обсерверы.

## Класс Bob
Класс отвечающий за Боба крайне прост: один метод, который пишет в лог.

## Класс Bill
Класс Билла несколько сложнее, ведь ему приходится отслеживать появление и исчезновение Боба. Рассматривать его стоит с объекта-ссылки:

    using BobLink = mtt::ObjectLink<Bob,
                                    Bill,
                                    &Bill::onBobIncoming,
                                    &Bill::onBobOutcoming,
                                    &Bill::bobLinkChanged>;
    BobLink bobLink;

mtt::ObjectLink - это вспомогательный шаблонный класс, который предназначен для работы совместно с mtt::Object. Он встраивается в родительский объект и делает всю рутинную работу по отслеживанию появления и исчезновения в сцене объекта, на который ссылается.

Шаблонные аргументы mtt::ObjectLink имеют следующий смысл:
*Referenced - тип объекта, за которым следит ссылка, в нашем случае это Боб.
*Observer - тип объекта, в который встраивается ссылочный тип, и который следит за другим объектом. В нашем случае - это Билл.
*linkPtr - указатель на каллбек-метод Observer-а, который будет вызван, когда Боб появится в сцене
*unlinkPtr - указатель на каллбек-метод Observer-а, который будет вызван, когда Боб уйдет со сцены.
*onChangedPtr - указатель на каллбек-метод Observer-а, который будет вызван, когда Боб либо появится, либо уйдет со сцены.

Вообще, любой из последних трех аргументов может быть nullptr. Так что класс Билла можно сократить до такого:

    class Bill : public mtt::Object
    {
      Q_OBJECT

    public:
      using BobLink = mtt::ObjectLink<Bob, Bill, nullptr, nullptr, nullptr>;
      BobLink bobLink;

    public:
      Bill() :
        Object("Bill", false),
        bobLink(*this)
      {
      }

      void askBob()
      {
        if(bobLink != nullptr) bobLink->toHammer();
        else mtt::Log() << "Bob is gone";
      }
    };

И это всё ещё работает.