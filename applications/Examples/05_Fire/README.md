# Кратко
Загружаем и анимируем эффект на основе системы частиц.

# Детально
## Эффект
PST-эффекты, это предварительно просчитанные эффекты на основе системы частиц, такие как огонь, дым, взрывы и т.д. Их можно создавать с помощью приложения ParticlesEditor, входящего в состав mtt.

Поддержка систем частиц и PST эффектов осуществляется в библиотеке mtt::particles, поэтому не забываем добавить particles в target_link_libraries в CMakeLists.txt.

Отрисовка эффекта производится с помощью класса mtt::PSTEffect. Загрузить эффект из файла можно либо с помощью конструктора чтения PSTEffect, либо используя библиотеку ресурсов mtt::PSTEffectLibrary. Библиотека позволяет избежать перерасхода памяти, когда необходимо использовать большое количество одинаковых эффектов (например необходимо создать много взрывов). Нас интересует единичный эффект, поэтому мы используем загрузку через конструктор:

    class Scene : public mtt::RenderScene
    {
    private:
      mtt::PSTEffect effect;
    ...
    Scene(mtt::LogicalDevice& displayDevice) :
      effect(":/fire.pst", nullptr, displayDevice),

Для того чтобы анимировать эффект, необходимо периодически вызывать метод PSTEffect::setTime. Этот метод обновляет данные частиц, из которых состоит эффект. В примере обновление производится с помощью QTimer и лямбда-функции.

    updateTimer.setSingleShot(false);
    QTimer::connect(&updateTimer,
                    &QTimer::timeout,
                    [&]
                    {
                      effect.setTime(
                                  effect.currentTime() + 30 * mtt::millisecond);
                    });
    updateTimer.start(30);

## PointLight
PST эффект - это система частиц, он не содержит в себе источников света, поэтому свет от огня мы имитируем с помощью clPipeline::PointLight. PointLight - это источник света, который светит из одной точки во все стороны одновременно, что хорошо подходит для имитации света от огня. Использование PointLight ничем не отличается от использования других источников света, рассмотренных ранее.

Если убрать PointLight со сцены, то можно получить не очевидный результат. Если закомментировать строку addCompositeObject(light), то дым исчезнет, в то время как огонь останется. На самом деле дым никуда не делся, просто без освещения он стал черным, и его не видно на черном фоне. В то же время частицы огня не зависят от освещения, поэтому их цвет не меняется при удалении источника света.